
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>6.2. Function Documentation &#8212; OCaml Programming: Correct + Efficient + Beautiful</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.c441f2ba0852f4cabcb80105e3a46ae6.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6.3. Module Documentation" href="module_docs.html" />
    <link rel="prev" title="6.1. Specifications" href="specifications.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/lambda-light.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">OCaml Programming: Correct + Efficient + Beautiful</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="current nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../intro/intro.html">
   1. Better Programming Through OCaml
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/past.html">
     1.1. The Past of OCaml
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/present.html">
     1.2. The Present of OCaml
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/future.html">
     1.3. Look to Your Future
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/about.html">
     1.4. About This Book
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/3110.html">
     1.5. A Brief History of CS 3110
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/summary.html">
     1.6. Summary
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../basics/intro.html">
   2. The Basics of OCaml
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/toplevel.html">
     2.1. The OCaml Toplevel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/compiling.html">
     2.2. Compiling OCaml Programs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/expressions.html">
     2.3. Expressions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/functions.html">
     2.4. Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/documentation.html">
     2.5. Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/printing.html">
     2.6. Printing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/debugging.html">
     2.7. Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/summary.html">
     2.8. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/exercises.html">
     2.9. Exercises
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../data/intro.html">
   3. Data and Types
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../data/lists.html">
     3.1. Lists
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/variants.html">
     3.2. Variants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/ounit.html">
     3.3. Unit Testing with OUnit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/records_tuples.html">
     3.4. Records and Tuples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/pattern_matching_advanced.html">
     3.5. Advanced Pattern Matching
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/type_synonym.html">
     3.6. Type Synonyms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/options.html">
     3.7. Options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/assoc_list.html">
     3.8. Association Lists
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/algebraic_data_types.html">
     3.9. Algebraic Data Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/exceptions.html">
     3.10. Exceptions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/trees.html">
     3.11. Example: Trees
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/nats.html">
     3.12. Example: Natural Numbers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/summary.html">
     3.13. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/exercises.html">
     3.14. Exercises
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../hop/intro.html">
   4. Higher-Order Programming
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/higher_order.html">
     4.1. Higher-Order Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/map.html">
     4.2. Map
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/filter.html">
     4.3. Filter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/fold.html">
     4.4. Fold
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/beyond_lists.html">
     4.5. Beyond Lists
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/pipelining.html">
     4.6. Pipelining
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/currying.html">
     4.7. Currying
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/summary.html">
     4.8. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/exercises.html">
     4.9. Exercises
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../modules/intro.html">
   5. Modular Programming
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/module_systems.html">
     5.1. Module Systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/modules.html">
     5.2. Modules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/toplevel.html">
     5.3. Modules and the Toplevel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/encapsulation.html">
     5.4. Encapsulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/functional_data_structures.html">
     5.5. Functional Data Structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/module_type_constraints.html">
     5.6. Module Type Constraints
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/compilation_units.html">
     5.7. Compilation Units
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/includes.html">
     5.8. Includes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/functors.html">
     5.9. Functors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/summary.html">
     5.10. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/exercises.html">
     5.11. Exercises
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="intro.html">
   6. Documentation and Testing
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="specifications.html">
     6.1. Specifications
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     6.2. Function Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="module_docs.html">
     6.3. Module Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="test_debug.html">
     6.4. Testing and Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="black_glass_box.html">
     6.5. Black-box and Glass-box Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="randomized.html">
     6.6. Randomized Testing with QCheck
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="summary.html">
     6.7. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="exercises.html">
     6.8. Exercises
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../../_sources/chapters/doctest/function_docs.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/chapters/doctest/function_docs.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/cs3110/textbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/cs3110/textbook/issues/new?title=Issue%20on%20page%20%2Fchapters/doctest/function_docs.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/cs3110/textbook/edit/jupyter/src/chapters/doctest/function_docs.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/cs3110/textbook/jupyter?urlpath=tree/src/chapters/doctest/function_docs.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#returns-clause">
   6.2.1. Returns Clause
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#requires-clause">
   6.2.2. Requires Clause
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#raises-clause">
   6.2.3. Raises Clause
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples-clause">
   6.2.4. Examples Clause
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-specification-game">
   6.2.5. The Specification Game
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comments">
   6.2.6. Comments
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="function-documentation">
<h1><span class="section-number">6.2. </span>Function Documentation<a class="headerlink" href="#function-documentation" title="Permalink to this headline">¶</a></h1>
<p><em>This section continues the discussion of
<a class="reference internal" href="../basics/documentation.html"><span class="doc std std-doc">documentation</span></a>, which we began in chapter 2.</em></p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/ggm5rjAyjhw" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>A specification is written for humans to read, not machines. “Specs” can take
time to write well, and it is time well spent. The main goal is clarity. It is
also important to be concise, because client programmers will not always take
the effort to read a long spec. As with anything we write, we need to be aware
of your audience when writing specifications. Some readers may need a more
verbose specification than others.</p>
<p>A well-written specification usually has several parts communicating different
kinds of information about the thing specified. If we know what the usual
ingredients of a specification are, we are less likely to forget to write down
something important. Let’s now look at a recipe for writing specifications.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/p5OTwjNTQIs" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<div class="section" id="returns-clause">
<h2><span class="section-number">6.2.1. </span>Returns Clause<a class="headerlink" href="#returns-clause" title="Permalink to this headline">¶</a></h2>
<p>How might we specify <code class="docutils literal notranslate"><span class="pre">sqr</span></code>, a square-root function? First, we need to describe
its result. We will call this description the <em>returns clause</em> because it is a
part of the specification that describes the result of a function call. It is
also known as a <em>postcondition</em>: it describes a condition that holds after the
function is called. Here is an example of a returns clause:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** returns: [sqr x] is the square root of [x]. *)</span>
</pre></div>
</div>
<p>But we would typically leave out the <code class="docutils literal notranslate"><span class="pre">returns:</span></code>, and simply write the returns
clause as the first sentence of the comment:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [sqr x] is the square root of [x]. *)</span>
</pre></div>
</div>
<p>For numerical programming, we should probably add some information about how
accurate it is.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [sqr x] is the square root of [x]. Its relative accuracy is no worse than</span>
<span class="c">    [1.0e-6]. *)</span>
</pre></div>
</div>
<p>Similarly, here’s how we might write a returns clause for a <code class="docutils literal notranslate"><span class="pre">find</span></code> function:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [find lst x] is the index of [x] in [lst], starting from zero. *)</span>
</pre></div>
</div>
<p>A good specification is concise but clear—it should say enough that the
reader understands what the function does, but without extra verbiage to plow
through and possibly cause the reader to miss the point. Sometimes there is a
balance to be struck between brevity and clarity.</p>
<p>These two specifications use a useful trick to make them more concise: they talk
about the result of applying the function being specified to some arbitrary
arguments. Implicitly we understand that the stated postcondition holds for all
possible values of any unbound variables (the argument variables).</p>
</div>
<div class="section" id="requires-clause">
<h2><span class="section-number">6.2.2. </span>Requires Clause<a class="headerlink" href="#requires-clause" title="Permalink to this headline">¶</a></h2>
<p>The specification for <code class="docutils literal notranslate"><span class="pre">sqr</span></code> doesn’t completely make sense because the square
root does not exist for some <code class="docutils literal notranslate"><span class="pre">x</span></code> of type <code class="docutils literal notranslate"><span class="pre">real</span></code>. The mathematical square root
function is a <em>partial</em> function that is defined over only part of its domain. A
good function specification is complete with respect to the possible inputs; it
provides the client with an understanding of what inputs are allowed and what
the results will be for allowed inputs.</p>
<p>We have several ways to deal with partial functions. A straightforward approach
is to restrict the domain so that it is clear the function cannot be
legitimately used on some inputs. The specification rules out bad inputs with a
<em>requires clause</em> establishing when the function may be called. This clause is
also called a <em>precondition</em> because it describes a condition that must hold
before the function is called. Here is a requires clause for <code class="docutils literal notranslate"><span class="pre">sqr</span></code>:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [sqr x] is the square root of [x]. Its relative accuracy is no worse</span>
<span class="c">    than [1.0e-6].  Requires: [x &gt;= 0] *)</span>
</pre></div>
</div>
<p>This specification doesn’t say what happens when <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">0</span></code>, nor does it have to.
Remember that the specification is a contract. This contract happens to push the
burden of showing that the square root exists onto the client. If the requires
clause is not satisfied, the implementation is permitted to do anything it
likes: for example, go into an infinite loop or throw an exception. The
advantage of this approach is that the implementer is free to design an
algorithm without the constraint of having to check for invalid input
parameters, which can be tedious and slow down the program. The disadvantage is
that it may be difficult to debug if the function is called improperly, because
the function can misbehave and the client has no understanding of how it might
misbehave.</p>
</div>
<div class="section" id="raises-clause">
<h2><span class="section-number">6.2.3. </span>Raises Clause<a class="headerlink" href="#raises-clause" title="Permalink to this headline">¶</a></h2>
<p>Another way to deal with partial functions is to convert them into total
functions (functions defined over their entire domain). This approach is
arguably easier for the client to deal with because the function’s behavior is
always defined; it has no precondition. However, it pushes work onto the
implementer and may lead to a slower implementation.</p>
<p>How can we convert <code class="docutils literal notranslate"><span class="pre">sqr</span></code> into a total function? One approach that is (too) often
followed is to define some value that is returned in the cases that the requires
clause would have ruled; for example:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [sqr x] is the square root of [x] if [x &gt;= 0],</span>
<span class="c">    with relative accuracy no worse than 1.0e-6.</span>
<span class="c">    Otherwise, a negative number is returned. *)</span>
</pre></div>
</div>
<p>This practice is not recommended because it tends to encourage broken,
hard-to-read client code. Almost any correct client of this abstraction will
write code like this if the precondition cannot be argued to hold:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">sqr</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span> <span class="k">then</span> <span class="o">...</span> <span class="k">else</span> <span class="o">...</span>
</pre></div>
</div>
<p>The error must still be handled in the <code class="docutils literal notranslate"><span class="pre">if</span></code> expression, so the job of the client
of this abstraction isn’t any easier than with a requires clause: the client
still needs to wrap an explicit test around the call in cases where it might
fail. If the test is omitted, the compiler won’t complain, and the negative
number result will be silently treated as if it were a valid square root, likely
causing errors later during program execution. This coding style has been the
source of innumerable bugs and security problems in the Unix operating systems
and its descendents (e.g., Linux).</p>
<p>A better way to make functions total is to have them raise an exception when the
expected input condition is not met. Exceptions avoid the necessity of
distracting error-handling logic in the client’s code. If the function is to be
total, the specification must say what exception is raised and when. For
example, we might make our square root function total as follows:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [sqr x] is the square root of [x], with relative accuracy no worse</span>
<span class="c">    than 1.0e-6. Raises: [Negative] if [x &lt; 0]. *)</span>
</pre></div>
</div>
<p>Note that the implementation of this <code class="docutils literal notranslate"><span class="pre">sqr</span></code> function must check whether <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code>,
even in the production version of the code, because some client may be relying
on the exception to be raised.</p>
</div>
<div class="section" id="examples-clause">
<h2><span class="section-number">6.2.4. </span>Examples Clause<a class="headerlink" href="#examples-clause" title="Permalink to this headline">¶</a></h2>
<p>It can be useful to provide an illustrative example as part of a specification.
No matter how clear and well written the specification is, an example is often
useful to clients.</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [find lst x] is the index of [x] in [lst], starting from zero.</span>
<span class="c">    Example: [find [&quot;b&quot;,&quot;a&quot;,&quot;c&quot;] &quot;a&quot; = 1]. *)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-specification-game">
<h2><span class="section-number">6.2.5. </span>The Specification Game<a class="headerlink" href="#the-specification-game" title="Permalink to this headline">¶</a></h2>
<p>When evaluating specifications, it can be useful to imagine that a game is being
played between two people: a <em>specifier</em> and a <em>devious programmer.</em></p>
<p>Suppose that the specifier writes the following specification:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** returns a list *)</span>
<span class="k">val</span> <span class="n">reverse</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
</pre></div>
</div>
<p>This spec is clearly incomplete.  For example, a devious programmer could meet
the spec with an implementation that gives the following output:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">reverse</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">];;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="kt">list</span> <span class="o">=</span> <span class="bp">[]</span>
</pre></div>
</div>
<p>The specifier, upon realizing this, refines the spec as follows:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [reverse lst] returns a list that is the same length as [lst] *)</span>
<span class="k">val</span> <span class="n">reverse</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
</pre></div>
</div>
<p>But the devious specifier discovers that the spec still allows broken
implementations:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">reverse</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">];;</span>
<span class="o">-</span> <span class="o">:</span> <span class="kt">int</span> <span class="kt">list</span> <span class="o">=</span> <span class="o">[</span><span class="mi">0</span><span class="o">;</span> <span class="mi">0</span><span class="o">;</span> <span class="mi">0</span><span class="o">]</span>
</pre></div>
</div>
<p>Finally, the specifier settles on a third spec:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="c">(** [reverse lst] returns a list [m] satisfying the following conditions:</span>
<span class="c">    - [length lst = length m]</span>
<span class="c">    - for all [i], [nth m i = nth lst (n - i - 1)],</span>
<span class="c">      where [n] is the length of [lst].</span>
<span class="c">    For example, [reverse [1; 2; 3]] is [3; 2; 1], and [reverse []] is []. *)</span>
<span class="k">val</span> <span class="n">reverse</span> <span class="o">:</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span> <span class="o">-&gt;</span> <span class="k">&#39;</span><span class="n">a</span> <span class="kt">list</span>
</pre></div>
</div>
<p>With this spec, the devious programmer is forced to provide a working
implementation to meet the spec, so the specifier has successfully written her
spec.</p>
<p>The point of playing this game is to improve your ability to write
specifications. Obviously we’re not advocating that you deliberately try to
violate the intent of a specification and get away with it. When reading someone
else’s specification, read as generously as possible. But be ruthless about
improving your own specifications.</p>
</div>
<div class="section" id="comments">
<h2><span class="section-number">6.2.6. </span>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<p>In addition to specifying functions, programmers need to provide comments in the
body of the functions. In fact, programmers usually do not write enough comments
in their code. But this doesn’t mean that adding more comments is always better.
The wrong comments will simply obscure the code further. Shoveling as many
comments into code as possible usually makes the code worse! Both code and
comments are precise tools for communication (with the computer and with other
programmers) that should be wielded carefully.</p>
<p>It is particularly annoying to read code that contains many interspersed
comments (typically of questionable value), e.g.:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="c">(* make y one greater than x *)</span>
</pre></div>
</div>
<p>For complex algorithms, some comments may be necessary to explain how the code
implementing the algorithm works. Programmers are often tempted to write
comments about the algorithm interspersed through the code. But someone reading
the code will often find these comments confusing because they don’t have a
high-level picture of the algorithm. It is usually better to write a
paragraph-style comment at the beginning of the function explaining how its
implementation works. Explicit points in the code that need to be related to
that paragraph can then be marked with very brief comments, like <code class="docutils literal notranslate"><span class="pre">(*</span> <span class="pre">case</span> <span class="pre">1</span> <span class="pre">*)</span></code>.</p>
<p>Another common but well-intentioned mistake is giving variables long,
descriptive names, as in the following verbose code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">number_of_zeros</span> <span class="n">the_list</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">accumulator</span> <span class="o">:</span> <span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">list_element</span> <span class="o">:</span> <span class="kt">int</span><span class="o">)</span> <span class="o">-&gt;</span>
    <span class="n">accumulator</span> <span class="o">+</span> <span class="o">(</span><span class="k">if</span> <span class="n">list_element</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span><span class="o">))</span> <span class="mi">0</span> <span class="n">the_list</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val number_of_zeros : int list -&gt; int = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>Code using such long names is verbose and hard to read. Instead of trying to
embed a complete description of a variable in its name, use a short and
suggestive name (e.g., <code class="docutils literal notranslate"><span class="pre">zeros</span></code>), and if necessary, add a comment at its
declaration explaining the purpose of the variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">zeros</span> <span class="n">lst</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">is0</span> <span class="o">=</span> <span class="k">function</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="mi">0</span> <span class="k">in</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span> <span class="o">(</span><span class="k">fun</span> <span class="n">zs</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">zs</span> <span class="o">+</span> <span class="n">is0</span> <span class="n">x</span><span class="o">)</span> <span class="mi">0</span> <span class="n">lst</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val zeros : int list -&gt; int = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>A similarly bad practice is to encode the type of the variable in its name, e.g.
naming a variable <code class="docutils literal notranslate"><span class="pre">i_count</span></code> to show that it’s an integer. The type system is
going to guarantee that for you, and your editor can provide a hover-over to
show the type. If you really want to emphasize the type in the code, add a type
annotation at the point where the variable comes into scope.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cs3110/textbook",
            ref: "jupyter",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ocaml-jupyter"
        },
        kernelOptions: {
            kernelName: "ocaml-jupyter",
            path: "./chapters/doctest"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ocaml-jupyter'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="specifications.html" title="previous page"><span class="section-number">6.1. </span>Specifications</a>
    <a class='right-next' id="next-link" href="module_docs.html" title="next page"><span class="section-number">6.3. </span>Module Documentation</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Michael R. Clarkson et al.<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>