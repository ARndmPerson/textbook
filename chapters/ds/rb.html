
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>8.3. Red-Black Trees &#8212; OCaml Programming: Correct + Efficient + Beautiful</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="8.4. Sequences" href="sequence.html" />
    <link rel="prev" title="8.2. Amortized Analysis" href="amortized.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/lambda-light.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">OCaml Programming: Correct + Efficient + Beautiful</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Preface
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../preface/about.html">
   About This Book
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../preface/install.html">
   Installing OCaml
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../intro/intro.html">
   1. Better Programming Through OCaml
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/past.html">
     1.1. The Past of OCaml
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/present.html">
     1.2. The Present of OCaml
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/future.html">
     1.3. Look to Your Future
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/3110.html">
     1.4. A Brief History of CS 3110
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/summary.html">
     1.5. Summary
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../basics/intro.html">
   2. The Basics of OCaml
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/toplevel.html">
     2.1. The OCaml Toplevel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/compiling.html">
     2.2. Compiling OCaml Programs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/expressions.html">
     2.3. Expressions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/functions.html">
     2.4. Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/documentation.html">
     2.5. Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/printing.html">
     2.6. Printing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/debugging.html">
     2.7. Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/summary.html">
     2.8. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics/exercises.html">
     2.9. Exercises
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  OCaml Programming
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../data/intro.html">
   3. Data and Types
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/lists.html">
     3.1. Lists
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/variants.html">
     3.2. Variants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/ounit.html">
     3.3. Unit Testing with OUnit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/records_tuples.html">
     3.4. Records and Tuples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/pattern_matching_advanced.html">
     3.5. Advanced Pattern Matching
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/type_synonym.html">
     3.6. Type Synonyms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/options.html">
     3.7. Options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/assoc_list.html">
     3.8. Association Lists
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/algebraic_data_types.html">
     3.9. Algebraic Data Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/exceptions.html">
     3.10. Exceptions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/trees.html">
     3.11. Example: Trees
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/nats.html">
     3.12. Example: Natural Numbers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/summary.html">
     3.13. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/exercises.html">
     3.14. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../hop/intro.html">
   4. Higher-Order Programming
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/higher_order.html">
     4.1. Higher-Order Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/map.html">
     4.2. Map
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/filter.html">
     4.3. Filter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/fold.html">
     4.4. Fold
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/beyond_lists.html">
     4.5. Beyond Lists
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/pipelining.html">
     4.6. Pipelining
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/currying.html">
     4.7. Currying
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/summary.html">
     4.8. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hop/exercises.html">
     4.9. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../modules/intro.html">
   5. Modular Programming
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/module_systems.html">
     5.1. Module Systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/modules.html">
     5.2. Modules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/toplevel.html">
     5.3. Modules and the Toplevel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/encapsulation.html">
     5.4. Encapsulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/compilation_units.html">
     5.5. Compilation Units
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/functional_data_structures.html">
     5.6. Functional Data Structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/module_type_constraints.html">
     5.7. Module Type Constraints
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/includes.html">
     5.8. Includes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/functors.html">
     5.9. Functors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/summary.html">
     5.10. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../modules/exercises.html">
     5.11. Exercises
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Correctness and Efficiency
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../correctness/intro.html">
   6. Correctness
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../correctness/specifications.html">
     6.1. Specifications
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../correctness/function_docs.html">
     6.2. Function Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../correctness/module_docs.html">
     6.3. Module Documentation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../correctness/test_debug.html">
     6.4. Testing and Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../correctness/black_glass_box.html">
     6.5. Black-box and Glass-box Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../correctness/randomized.html">
     6.6. Randomized Testing with QCheck
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../correctness/proving_correctness.html">
     6.7. Proving Correctness
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../correctness/structural_induction.html">
     6.8. Structural Induction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../correctness/alg_spec.html">
     6.9. Algebraic Specification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../correctness/summary.html">
     6.10. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../correctness/exercises.html">
     6.11. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mut/intro.html">
   7. Mutability
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mut/refs.html">
     7.1. Refs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mut/mutable_fields.html">
     7.2. Mutable Fields
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mut/arrays.html">
     7.3. Arrays and Loops
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mut/summary.html">
     7.4. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mut/exercises.html">
     7.5. Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="intro.html">
   8. Data Structures
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="hash_tables.html">
     8.1. Hash Tables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="amortized.html">
     8.2. Amortized Analysis
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     8.3. Red-Black Trees
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sequence.html">
     8.4. Sequences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="memoization.html">
     8.5. Memoization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="promises.html">
     8.6. Promises
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="monads.html">
     8.7. Monads
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="summary.html">
     8.8. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="exercises.html">
     8.9. Exercises
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Language Implementation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../interp/intro.html">
   9. Interpreters
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../interp/calculator.html">
     9.1. Example: Calculator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../interp/parsing.html">
     9.2. Parsing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../interp/substitution.html">
     9.3. Substitution Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../interp/environment.html">
     9.4. Environment Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../interp/typecheck.html">
     9.5. Type Checking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../interp/inference.html">
     9.6. Type Inference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../interp/summary.html">
     9.7. Summary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../interp/exercises.html">
     9.8. Exercises
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Lagniappe
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../adv/curry-howard.html">
   The Curry-Howard Correspondence
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../appendix/bigoh.html">
   Big-Oh Notation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../appendix/vm.html">
   Virtual Machine
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/cs3110/textbook/main?urlpath=tree/src/chapters/ds/rb.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/cs3110/textbook"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/cs3110/textbook/issues/new?title=Issue%20on%20page%20%2Fchapters/ds/rb.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/cs3110/textbook/edit/main/src/chapters/ds/rb.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/chapters/ds/rb.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="../../_sources/chapters/ds/rb.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#binary-search-trees">
   8.3.1. Binary Search Trees
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   8.3.2. Red-Black Trees
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#maps-and-sets-from-bsts">
   8.3.3. Maps and Sets from BSTs
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Red-Black Trees</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#binary-search-trees">
   8.3.1. Binary Search Trees
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   8.3.2. Red-Black Trees
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#maps-and-sets-from-bsts">
   8.3.3. Maps and Sets from BSTs
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="red-black-trees">
<h1><span class="section-number">8.3. </span>Red-Black Trees<a class="headerlink" href="#red-black-trees" title="Permalink to this headline">#</a></h1>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/uOKHuYloCsI" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>As we’ve now seen, hash tables are an efficient data structure for implementing
a map ADT. They offer amortized, expected constant-time performance—which
is a subtle guarantee because of those “amortized” and “expected” qualifiers we
have to add. Hash tables also require mutability to implement.  As functional
programmers, we prefer to avoid mutability when possible.</p>
<p>So, let’s investigate how to implement functional maps. One of the best data
structures for that is the <em>red-black tree</em>, which is a kind of balanced binary
search tree that offers worst-case logarithmic performance. So on one hand the
performance is somewhat worse than hash tables (logarithmic vs. constant), but
on the other hand we don’t have to qualify the performance with words like
“amortized” and “expected”. Logarithmic is actually still plenty efficient for
even very large workloads. And, we get to avoid mutability!</p>
<section id="binary-search-trees">
<h2><span class="section-number">8.3.1. </span>Binary Search Trees<a class="headerlink" href="#binary-search-trees" title="Permalink to this headline">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/Xx9V5vrkjJA" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>A <strong>binary search tree</strong> (BST) is a binary tree with the following
representation invariant:</p>
<blockquote>
<div><p>For any node <em>n</em>, every node in the left subtree of <em>n</em> has a value less than
<em>n</em>’s value, and every node in the right subtree of <em>n</em> has a value greater
than <em>n</em>’s value.</p>
</div></blockquote>
<p>We call that the <em>BST invariant</em>.</p>
<p>Here is code that implements a couple of operations on a BST:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">tree</span> <span class="o">=</span> <span class="nc">Node</span> <span class="k">of</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">tree</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">tree</span> <span class="o">|</span> <span class="nc">Leaf</span>

<span class="c">(** [mem x t] is [true] iff [x] is a member of [t]. *)</span>
<span class="k">let</span> <span class="k">rec</span> <span class="n">mem</span> <span class="n">x</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="bp">false</span>
  <span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="k">then</span> <span class="n">mem</span> <span class="n">x</span> <span class="n">l</span>
    <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span> <span class="k">then</span> <span class="n">mem</span> <span class="n">x</span> <span class="n">r</span>
    <span class="k">else</span> <span class="bp">true</span>

<span class="c">(** [insert x t] is [t] . *)</span>
<span class="k">let</span> <span class="k">rec</span> <span class="n">insert</span> <span class="n">x</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)</span>
  <span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="k">as</span> <span class="n">t</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="k">then</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">insert</span> <span class="n">x</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span>
    <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span> <span class="k">then</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">insert</span> <span class="n">x</span> <span class="n">r</span><span class="o">)</span>
    <span class="k">else</span> <span class="n">t</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type &#39;a tree = Node of &#39;a * &#39;a tree * &#39;a tree | Leaf
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val mem : &#39;a -&gt; &#39;a tree -&gt; bool = &lt;fun&gt;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val insert : &#39;a -&gt; &#39;a tree -&gt; &#39;a tree = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>What is the running time of those operations? Since <code class="docutils literal notranslate"><span class="pre">insert</span></code> is just a <code class="docutils literal notranslate"><span class="pre">mem</span></code>
with an extra constant-time node creation, we focus on the <code class="docutils literal notranslate"><span class="pre">mem</span></code> operation.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/pFUJgaYUH6o" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>The running time of <code class="docutils literal notranslate"><span class="pre">mem</span></code> is <span class="math notranslate nohighlight">\(O(h)\)</span>, where <span class="math notranslate nohighlight">\(h\)</span> is the height of the tree,
because every recursive call descends one level in the tree. What’s the
worst-case height of a tree? It occurs with a tree of <span class="math notranslate nohighlight">\(n\)</span> nodes all in a single
long branch—imagine adding the numbers 1,2,3,4,5,6,7 in order into the
tree. So the worst-case running time of <code class="docutils literal notranslate"><span class="pre">mem</span></code> is still <span class="math notranslate nohighlight">\(O(n)\)</span>, where <span class="math notranslate nohighlight">\(n\)</span> is the
number of nodes in the tree.</p>
<p>What is a good shape for a tree that would allow for fast lookup? A <em>perfect
binary tree</em> has the largest number of nodes <span class="math notranslate nohighlight">\(n\)</span> for a given height <span class="math notranslate nohighlight">\(h\)</span>, which
is <span class="math notranslate nohighlight">\(n = 2^{h+1} - 1\)</span>. Therefore <span class="math notranslate nohighlight">\(h = \log(n+1) - 1\)</span>, which is <span class="math notranslate nohighlight">\(O(\log n)\)</span>.</p>
<p>If a tree with <span class="math notranslate nohighlight">\(n\)</span> nodes is kept balanced, its height is <span class="math notranslate nohighlight">\(O(\log n)\)</span>, which
leads to a lookup operation running in time <span class="math notranslate nohighlight">\(O(\log n)\)</span>.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/BGkipOJdH3U" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>How can we keep a tree balanced? It can become unbalanced during element
insertion or deletion. Most balanced tree schemes involve adding or deleting an
element just like in a normal binary search tree, followed by some kind of <em>tree
surgery</em> to rebalance the tree. Some examples of balanced binary search tree
data structures include:</p>
<ul class="simple">
<li><p>AVL trees (1962)</p></li>
<li><p>2-3 trees (1970’s)</p></li>
<li><p>Red-black trees (1970’s)</p></li>
</ul>
<p>Each of these ensures <span class="math notranslate nohighlight">\(O(\log n)\)</span> running time by enforcing a stronger invariant
on the data structure than just the binary search tree invariant.</p>
</section>
<section id="id1">
<h2><span class="section-number">8.3.2. </span>Red-Black Trees<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/JzhG0jDxGqg" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>Red-black trees are relatively simple balanced binary tree data structure. The
idea is to strengthen the representation invariant so a tree has height
logarithmic in the number of nodes <span class="math notranslate nohighlight">\(n\)</span>. To help enforce the invariant, we color
each node of the tree either <em>red</em> or <em>black</em>. Where it matters, we consider the
color of an empty tree to be black.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">color</span> <span class="o">=</span> <span class="nc">Red</span> <span class="o">|</span> <span class="nc">Black</span>
<span class="k">type</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">rbtree</span> <span class="o">=</span> <span class="nc">Leaf</span> <span class="o">|</span> <span class="nc">Node</span> <span class="k">of</span> <span class="n">color</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">rbtree</span> <span class="o">*</span> <span class="k">&#39;</span><span class="n">a</span> <span class="n">rbtree</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type color = Red | Black
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>type &#39;a rbtree = Leaf | Node of color * &#39;a * &#39;a rbtree * &#39;a rbtree
</pre></div>
</div>
</div>
</div>
<p>Here are the new conditions we add to the binary search tree representation
invariant:</p>
<ol class="simple">
<li><p><strong>Local Invariant:</strong> There are no two adjacent red nodes along any path.</p></li>
<li><p><strong>Global Invariant:</strong> Every path from the root to a leaf has the same number
of black nodes. This number is called the <em>black height</em> (BH) of the tree.</p></li>
</ol>
<p>If a tree satisfies these two conditions, it must also be the case that every
subtree of the tree also satisfies the conditions. If a subtree violated either
of the conditions, the whole tree would also.</p>
<p>Additionally, by convention the root of the tree is colored black. This does not
violate the invariants, but it also is not required by them.</p>
<p>With these invariants, the longest possible path from the root to an empty node
would alternately contain red and black nodes; therefore it is at most twice as
long as the shortest possible path, which only contains black nodes. The longest
path cannot have a length greater than twice the length of the paths in a
perfect binary tree, which is <span class="math notranslate nohighlight">\(O(\log n)\)</span>. Therefore, the tree has height
<span class="math notranslate nohighlight">\(O(\log n)\)</span> and the operations are all asymptotically logarithmic in the number
of nodes.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/gDTCRj2-bCU" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>How do we check for membership in red-black trees? Exactly the same way as for
general binary trees.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">mem</span> <span class="n">x</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="bp">false</span>
  <span class="o">|</span> <span class="nc">Node</span> <span class="o">(_,</span> <span class="n">y</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="k">then</span> <span class="n">mem</span> <span class="n">x</span> <span class="n">l</span>
    <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span> <span class="k">then</span> <span class="n">mem</span> <span class="n">x</span> <span class="n">r</span>
    <span class="k">else</span> <span class="bp">true</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val mem : &#39;a -&gt; &#39;a rbtree -&gt; bool = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p><strong>Okasaki’s Algorithm.</strong> More interesting is the <code class="docutils literal notranslate"><span class="pre">insert</span></code> operation. As with
standard binary trees, we add a node by replacing the leaf found by the search
procedure. But what can we color that node?</p>
<ul class="simple">
<li><p>Coloring it black could increase the black height of that path, violating the
Global Invariant.</p></li>
<li><p>Coloring it red could make it adjacent to another red node, violating the
Local Invariant.</p></li>
</ul>
<p>So neither choice is safe in general. Chris Okasaki (<em>Purely Functional Data
Structures</em>, 1999) gives an elegant algorithm that solves the problem by opting
to violate the Local Invariant, then walk up the tree to repair the violation.
Here’s how it works.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/dCBAhbIEoYM" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>We always color the new node red to ensure that the Global Invariant is
preserved. However, this may destroy the Local Invariant by producing two
adjacent red nodes. In order to restore the invariant, we consider not only the
new red node and its red parent, but also its (black) grandparent.</p>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/igUOhpGICgA" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>The next figure shows the four possible cases that can arise. In it, <code class="docutils literal notranslate"><span class="pre">a</span></code>-<code class="docutils literal notranslate"><span class="pre">d</span></code> are
possibly empty subtrees, and <code class="docutils literal notranslate"><span class="pre">x</span></code>-<code class="docutils literal notranslate"><span class="pre">z</span></code> are values stored at a node. The nodes
colors are indicated with <code class="docutils literal notranslate"><span class="pre">R</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>           1             2             3             4

           Bz            Bz            Bx            Bx
          / \           / \           / \           / \
         Ry  d         Rx  d         a   Rz        a   Ry
        /  \          / \               /  \          /  \
      Rx   c         a   Ry            Ry   d        b    Rz
     /  \               /  \          / \                /  \
    a    b             b    c        b   c              c    d
</pre></div>
</div>
<p>Notice that in each of these trees, we’ve carefully labeled the values and nodes
such that the binary search tree invariant ensures the following ordering:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">all</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">a</span>
 <span class="o">&lt;</span>
  <span class="n">x</span>
   <span class="o">&lt;</span>
    <span class="nb">all</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">b</span>
     <span class="o">&lt;</span>
      <span class="n">y</span>
       <span class="o">&lt;</span>
        <span class="nb">all</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">c</span>
         <span class="o">&lt;</span>
          <span class="n">z</span>
           <span class="o">&lt;</span>
            <span class="nb">all</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">d</span>
</pre></div>
</div>
<p>Therefore, we can transform the tree to restore the invariant locally by
replacing any of the above four cases with:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>         Ry
        /  \
      Bx    Bz
     / \   / \
    a   b c   d
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To really understand Okasaki’s algorithm, ensure that the last three diagrams
make sense. The choice of which labels are placed where in the first diagram is
crucial. That’s what guarantees the ordering holds, hence that the final tree is
the same in all four cases.</p>
</div>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/D4FJMJUIMSw" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>This balance function can be written simply and concisely using pattern
matching, where each of the four input cases is mapped to the same output case.
In addition, there is the case where the tree is left unchanged locally.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">balance</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="nc">Black</span><span class="o">,</span> <span class="n">z</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Red</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Red</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">),</span> <span class="n">c</span><span class="o">),</span> <span class="n">d</span>
  <span class="o">|</span> <span class="nc">Black</span><span class="o">,</span> <span class="n">z</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Red</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Red</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">)),</span> <span class="n">d</span>
  <span class="o">|</span> <span class="nc">Black</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Red</span><span class="o">,</span> <span class="n">z</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Red</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">),</span> <span class="n">d</span><span class="o">)</span>
  <span class="o">|</span> <span class="nc">Black</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Red</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Red</span><span class="o">,</span> <span class="n">z</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">))</span> <span class="o">-&gt;</span>
    <span class="nc">Node</span> <span class="o">(</span><span class="nc">Red</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Black</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">),</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Black</span><span class="o">,</span> <span class="n">z</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">))</span>
  <span class="o">|</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span> <span class="o">-&gt;</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val balance : color * &#39;a * &#39;a rbtree * &#39;a rbtree -&gt; &#39;a rbtree = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<p>This balancing transformation possibly breaks the Local Invariant one level up
in the tree, but it can be restored again at that level in the same way, and so
on up the tree. In the worst case, the process cascades all the way up to the
root, resulting in two adjacent red nodes, one of them the root. But if this
happens, we can just recolor the root black, which increases the black height by
one. The amount of work is <span class="math notranslate nohighlight">\(O(\log n)\)</span>. The <code class="docutils literal notranslate"><span class="pre">insert</span></code> code using <code class="docutils literal notranslate"><span class="pre">balance</span></code> is as
follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-OCaml notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">insert</span> <span class="n">x</span> <span class="n">s</span> <span class="o">=</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">ins</span> <span class="o">=</span> <span class="k">function</span>
    <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Red</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">,</span> <span class="nc">Leaf</span><span class="o">)</span>
    <span class="o">|</span> <span class="nc">Node</span> <span class="o">(</span><span class="n">color</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="k">as</span> <span class="n">s</span> <span class="o">-&gt;</span>
      <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="k">then</span> <span class="n">balance</span> <span class="o">(</span><span class="n">color</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">ins</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span> <span class="k">then</span> <span class="n">balance</span> <span class="o">(</span><span class="n">color</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">ins</span> <span class="n">b</span><span class="o">)</span>
      <span class="k">else</span> <span class="n">s</span>
  <span class="k">in</span>
  <span class="k">match</span> <span class="n">ins</span> <span class="n">s</span> <span class="k">with</span>
  <span class="o">|</span> <span class="nc">Node</span> <span class="o">(_,</span> <span class="n">y</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">Node</span> <span class="o">(</span><span class="nc">Black</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span>
  <span class="o">|</span> <span class="nc">Leaf</span> <span class="o">-&gt;</span> <span class="c">(* guaranteed to be nonempty *)</span>
    <span class="n">failwith</span> <span class="s2">&quot;RBT insert failed with ins returning leaf&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>val insert : &#39;a -&gt; &#39;a rbtree -&gt; &#39;a rbtree = &lt;fun&gt;
</pre></div>
</div>
</div>
</div>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/giSzhfuTMMA" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p><strong>The remove operation.</strong> Removing an element from a red-black tree works
analogously. We start with a BST element removal and then do rebalancing. When
an interior (nonleaf) node is removed, we simply splice it out if it has fewer
than two nonleaf children; if it has two nonleaf children, we find the next
value in the tree, which must be found inside its right child.</p>
<p>But, balancing the trees during removal from red-black tree requires considering
more cases. Deleting a black element from the tree creates the possibility that
some path in the tree has too few black nodes, breaking the Global Invariant.</p>
<p>Germane and Might invented an elegant algorithm to handle that rebalancing Their
solution is to create “doubly-black” nodes that count twice in determining the
black height. For more, read their paper: [<em>Deletion: The Curse of the Red-Black
Tree</em> <em>Journal of Functional Programming</em>], volume 24, issue 4, July 2014.</p>
</section>
<section id="maps-and-sets-from-bsts">
<h2><span class="section-number">8.3.3. </span>Maps and Sets from BSTs<a class="headerlink" href="#maps-and-sets-from-bsts" title="Permalink to this headline">#</a></h2>
<div class="container16x9"><iframe src="https://www.youtube.com/embed/B_e8Qr4nl4A" class="responsive-iframe" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p>It’s easy to use a BST to implement either a map or a set ADT:</p>
<ul class="simple">
<li><p>For a map, just store a binding at each node. The nodes are ordered by the
keys. The values are irrelevant to the ordering.</p></li>
<li><p>For a set, just store an element at each node. The nodes are ordered by the
elements.</p></li>
</ul>
<p>The OCaml standard library does this for the <code class="docutils literal notranslate"><span class="pre">Map</span></code> and <code class="docutils literal notranslate"><span class="pre">Set</span></code> modules. It uses a
balanced BST that is a variant of an AVL tree. AVL trees are balanced BSTs in
which the height of paths is allowed to vary by at most 1. The OCaml standard
library modifies that to allow the height to vary by at most 2. Like red-black
trees, they achieve worst-case logarithmic performance.</p>
<p>Now that we have a functional map data structure, how does it compare to our
imperative version, the hash table?</p>
<ul class="simple">
<li><p><strong>Persistence:</strong> Our red-black trees are persistent, but hash tables are
ephemeral.</p></li>
<li><p><strong>Performance:</strong> We get guaranteed worst-case logarithmic performance with
red-black trees, but amortized, expected constant-time with hash tables.
That’s somewhat hard to compare given all the modifiers involved. It’s also an
example of a general phenomenon that persistent data structures often have to
pay an extra logarithmic cost over the equivalent ephemeral data structures.</p></li>
<li><p><strong>Convenience:</strong> We have to provide an ordering function for balanced binary
trees, and a hash function for hash tables. Most libraries provide a default
hash function for convenience. But the performance of the hash table does
depend on that hash function truly distributing keys randomly over buckets. If
it doesn’t, the “expected” part of the performance guarantee for hash tables
is violated. So the convenience is a double-edged sword.</p></li>
</ul>
<p>There isn’t a clear winner here. Since the OCaml library provides both <code class="docutils literal notranslate"><span class="pre">Map</span></code> and
<code class="docutils literal notranslate"><span class="pre">Hashtbl</span></code>, you get to choose.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cs3110/textbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "ocaml-jupyter"
        },
        kernelOptions: {
            kernelName: "ocaml-jupyter",
            path: "./chapters/ds"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ocaml-jupyter'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="amortized.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">8.2. </span>Amortized Analysis</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="sequence.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">8.4. </span>Sequences</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Michael R. Clarkson et al.<br/>
  
      &copy; Copyright 2021.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>